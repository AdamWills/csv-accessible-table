function doConvert(){var a=$("#csvText").val(),b=$("#optFirstRowHeaders").prop("checked"),c=$("#optFirstColHeaders").prop("checked"),d=$("#optLastRowFooter").prop("checked"),e=$("#optCaption").prop("checked"),f=$("#textCaption").val(),g=$("#table-preview");a=$.trim(a).replace(/\s*[\r\n]+\s*/g,"\n").replace(/(<[^\/][^>]*>)\s*/g,"$1").replace(/\s*(<\/[^>]+>)/g,"$1"),csvArray=$.csv.toArrays(a);var h="<table>\n";if(e&&(h+="<caption>"+f+"</caption>\n"),b){var i="",j=csvArray[0];i+="  <thead>\n    <tr>\n",$.each(j,function(a,b){i+='      <th scope="col">'+b+"</th>\n"}),i+="    </tr>\n  </thead>\n",h+=i,csvArray.splice(0,1)}if(d){var k="",l=csvArray.length-1,m=csvArray[l];k+="  <tfoot>\n    <tr>\n",$.each(m,function(a,b){k+="      <th>"+b+"</th>\n"}),k+="    </tr>\n  </tfoot>\n",h+=k,csvArray.splice(l,1)}var n="  <tbody>\n";$.each(csvArray,function(a,b){var d="    <tr>\n";$.each(b,function(a,b){d+=0===a&&c?'      <th scope="row">'+b+"</th>\n":"      <td>"+b+"</td>\n"}),d+="    </tr>\n",n+=d}),n+="  </tbody>\n",h+=n,h+="</table>",$("#htmlText").val(h),g.html(h),g.find("table").addClass("table"),$(".output").removeClass("hidden")}function showSuccess(){$(".alerts .alert-success").removeClass("hidden")}function showError(){$(".alerts .alert-danger").removeClass("hidden")}function hideErrors(){$(".alerts .alert").addClass("hidden")}function displayFileContents(a){var b=$("#csvText");b.val("");var c=["text/comma-separated-values","text/csv","application/csv","application/excel","application/vnd.ms-excel","application/vnd.msexcel","text/anytext"];if($.inArray(a.type,c)>-1){var d=new FileReader;d.onload=function(){b.val(d.result)},d.readAsText(a),showSuccess(),$(".step2").removeClass("hidden"),$(".csv-file-contents").removeClass("hidden")}else showError();return!1}var _gaq=_gaq||[];if(_gaq.push(["_setAccount","UA-9487590-12"]),_gaq.push(["_trackPageview"]),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),$("#optCaption").change(function(){$(".caption").toggleClass("hidden")}),$(".button-caption-help").click(function(a){a.preventDefault(),$(".captionDescription").toggleClass("hidden")}),$(".preview-csv-contents").click(function(a){a.preventDefault(),$(".csv-text-container").toggleClass("hidden")}),$("#btn-upload").click(function(a){a.stopPropagation(),a.preventDefault(),$("#fileInput").click()}),window.File&&window.FileReader){var fileDrop=document.getElementById("filedrop"),fileInput=document.getElementById("fileInput");$(".file-container").removeClass("hidden"),$("label.csv-text").html("Your CSV file contents:"),$(".csv-file-contents").addClass("hidden"),fileDrop.className="visible",fileDrop.ondragover=function(){return this.className="hover",!1},fileDrop.ondragend=function(){return this.className="",!1},fileDrop.ondrop=function(a){hideErrors(),this.className="",a.preventDefault();var b=a.dataTransfer.files[0];return _gaq.push(["_trackEvent","Upload","Method","Drag and drop"]),displayFileContents(b),!1},fileInput.addEventListener("change",function(){hideErrors();var a=fileInput.files[0];return _gaq.push(["_trackEvent","Upload","Method","File Input"]),displayFileContents(a),!1})}!function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}(),RegExp.escape=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},function(a){"use strict";a.csv={defaults:{separator:",",delimiter:'"',headers:!0},hooks:{castToScalar:function(a){var b=/\./;if(isNaN(a))return a;if(b.test(a))return parseFloat(a);var c=parseInt(a);return isNaN(c)?null:c}},parsers:{parse:function(a,b){function c(){if(i=0,j="",b.start&&b.state.rowNum<b.start)return h=[],b.state.rowNum++,b.state.colNum=1,void 0;if(void 0===b.onParseEntry)g.push(h);else{var a=b.onParseEntry(h,b.state);a!==!1&&g.push(a)}h=[],b.end&&b.state.rowNum>=b.end&&(k=!0),b.state.rowNum++,b.state.colNum=1}function d(){if(void 0===b.onParseValue)h.push(j);else{var a=b.onParseValue(j,b.state);a!==!1&&h.push(a)}j="",i=0,b.state.colNum++}var e=b.separator,f=b.delimiter;b.state.rowNum||(b.state.rowNum=1),b.state.colNum||(b.state.colNum=1);var g=[],h=[],i=0,j="",k=!1,l=RegExp.escape(e),m=RegExp.escape(f),n=/(D|S|\n|\r|[^DS\r\n]+)/,o=n.source;return o=o.replace(/S/g,l),o=o.replace(/D/g,m),n=RegExp(o,"gm"),a.replace(n,function(a){if(!k)switch(i){case 0:if(a===e){j+="",d();break}if(a===f){i=1;break}if("\n"===a){d(),c();break}if(/^\r$/.test(a))break;j+=a,i=3;break;case 1:if(a===f){i=2;break}j+=a,i=1;break;case 2:if(a===f){j+=a,i=1;break}if(a===e){d();break}if("\n"===a){d(),c();break}if(/^\r$/.test(a))break;throw new Error("CSVDataError: Illegal State [Row:"+b.state.rowNum+"][Col:"+b.state.colNum+"]");case 3:if(a===e){d();break}if("\n"===a){d(),c();break}if(/^\r$/.test(a))break;if(a===f)throw new Error("CSVDataError: Illegal Quote [Row:"+b.state.rowNum+"][Col:"+b.state.colNum+"]");throw new Error("CSVDataError: Illegal Data [Row:"+b.state.rowNum+"][Col:"+b.state.colNum+"]");default:throw new Error("CSVDataError: Unknown State [Row:"+b.state.rowNum+"][Col:"+b.state.colNum+"]")}}),0!==h.length&&(d(),c()),g},splitLines:function(a,b){function c(){if(g=0,b.start&&b.state.rowNum<b.start)return h="",b.state.rowNum++,void 0;if(void 0===b.onParseEntry)f.push(h);else{var a=b.onParseEntry(h,b.state);a!==!1&&f.push(a)}h="",b.end&&b.state.rowNum>=b.end&&(i=!0),b.state.rowNum++}var d=b.separator,e=b.delimiter;b.state.rowNum||(b.state.rowNum=1);var f=[],g=0,h="",i=!1,j=RegExp.escape(d),k=RegExp.escape(e),l=/(D|S|\n|\r|[^DS\r\n]+)/,m=l.source;return m=m.replace(/S/g,j),m=m.replace(/D/g,k),l=RegExp(m,"gm"),a.replace(l,function(a){if(!i)switch(g){case 0:if(a===d){h+=a,g=0;break}if(a===e){h+=a,g=1;break}if("\n"===a){c();break}if(/^\r$/.test(a))break;h+=a,g=3;break;case 1:if(a===e){h+=a,g=2;break}h+=a,g=1;break;case 2:var f=h.substr(h.length-1);if(a===e&&f===e){h+=a,g=1;break}if(a===d){h+=a,g=0;break}if("\n"===a){c();break}if("\r"===a)break;throw new Error("CSVDataError: Illegal state [Row:"+b.state.rowNum+"]");case 3:if(a===d){h+=a,g=0;break}if("\n"===a){c();break}if("\r"===a)break;if(a===e)throw new Error("CSVDataError: Illegal quote [Row:"+b.state.rowNum+"]");throw new Error("CSVDataError: Illegal state [Row:"+b.state.rowNum+"]");default:throw new Error("CSVDataError: Unknown state [Row:"+b.state.rowNum+"]")}}),""!==h&&c(),f},parseEntry:function(a,b){function c(){if(void 0===b.onParseValue)f.push(h);else{var a=b.onParseValue(h,b.state);a!==!1&&f.push(a)}h="",g=0,b.state.colNum++}var d=b.separator,e=b.delimiter;b.state.rowNum||(b.state.rowNum=1),b.state.colNum||(b.state.colNum=1);var f=[],g=0,h="";if(!b.match){var i=RegExp.escape(d),j=RegExp.escape(e),k=/(D|S|\n|\r|[^DS\r\n]+)/,l=k.source;l=l.replace(/S/g,i),l=l.replace(/D/g,j),b.match=RegExp(l,"gm")}return a.replace(b.match,function(a){switch(g){case 0:if(a===d){h+="",c();break}if(a===e){g=1;break}if("\n"===a||"\r"===a)break;h+=a,g=3;break;case 1:if(a===e){g=2;break}h+=a,g=1;break;case 2:if(a===e){h+=a,g=1;break}if(a===d){c();break}if("\n"===a||"\r"===a)break;throw new Error("CSVDataError: Illegal State [Row:"+b.state.rowNum+"][Col:"+b.state.colNum+"]");case 3:if(a===d){c();break}if("\n"===a||"\r"===a)break;if(a===e)throw new Error("CSVDataError: Illegal Quote [Row:"+b.state.rowNum+"][Col:"+b.state.colNum+"]");throw new Error("CSVDataError: Illegal Data [Row:"+b.state.rowNum+"][Col:"+b.state.colNum+"]");default:throw new Error("CSVDataError: Unknown State [Row:"+b.state.rowNum+"][Col:"+b.state.colNum+"]")}}),c(),f}},toArray:function(b,c,d){var c=void 0!==c?c:{},e={};e.callback=void 0!==d&&"function"==typeof d?d:!1,e.separator="separator"in c?c.separator:a.csv.defaults.separator,e.delimiter="delimiter"in c?c.delimiter:a.csv.defaults.delimiter;var f=void 0!==c.state?c.state:{},c={delimiter:e.delimiter,separator:e.separator,onParseEntry:c.onParseEntry,onParseValue:c.onParseValue,state:f},g=a.csv.parsers.parseEntry(b,c);return e.callback?(e.callback("",g),void 0):g},toArrays:function(b,c,d){var c=void 0!==c?c:{},e={};e.callback=void 0!==d&&"function"==typeof d?d:!1,e.separator="separator"in c?c.separator:a.csv.defaults.separator,e.delimiter="delimiter"in c?c.delimiter:a.csv.defaults.delimiter;var f=[],c={delimiter:e.delimiter,separator:e.separator,onParseEntry:c.onParseEntry,onParseValue:c.onParseValue,start:c.start,end:c.end,state:{rowNum:1,colNum:1}};return f=a.csv.parsers.parse(b,c),e.callback?(e.callback("",f),void 0):f},toObjects:function(b,c,d){var c=void 0!==c?c:{},e={};e.callback=void 0!==d&&"function"==typeof d?d:!1,e.separator="separator"in c?c.separator:a.csv.defaults.separator,e.delimiter="delimiter"in c?c.delimiter:a.csv.defaults.delimiter,e.headers="headers"in c?c.headers:a.csv.defaults.headers,c.start="start"in c?c.start:1,e.headers&&c.start++,c.end&&e.headers&&c.end++;var f=[],g=[],c={delimiter:e.delimiter,separator:e.separator,onParseEntry:c.onParseEntry,onParseValue:c.onParseValue,start:c.start,end:c.end,state:{rowNum:1,colNum:1},match:!1},h={delimiter:e.delimiter,separator:e.separator,start:1,end:1,state:{rowNum:1,colNum:1}},i=a.csv.parsers.splitLines(b,h),j=a.csv.toArray(i[0],c),f=a.csv.parsers.splitLines(b,c);c.state.colNum=1,c.state.rowNum=j?2:1;for(var k=0,l=f.length;l>k;k++){var m=a.csv.toArray(f[k],c),n={};for(var o in j)n[j[o]]=m[o];g.push(n),c.state.rowNum++}return e.callback?(e.callback("",g),void 0):g},fromArrays:function(b,c,d){var c=void 0!==c?c:{},e={};if(e.callback=void 0!==d&&"function"==typeof d?d:!1,e.separator="separator"in c?c.separator:a.csv.defaults.separator,e.delimiter="delimiter"in c?c.delimiter:a.csv.defaults.delimiter,e.escaper="escaper"in c?c.escaper:a.csv.defaults.escaper,e.experimental="experimental"in c?c.experimental:!1,!e.experimental)throw new Error("not implemented");var f=[];for(i in b)f.push(b[i]);return e.callback?(e.callback("",f),void 0):f},fromObjects2CSV:function(b,c,d){var c=void 0!==c?c:{},e={};if(e.callback=void 0!==d&&"function"==typeof d?d:!1,e.separator="separator"in c?c.separator:a.csv.defaults.separator,e.delimiter="delimiter"in c?c.delimiter:a.csv.defaults.delimiter,e.experimental="experimental"in c?c.experimental:!1,!e.experimental)throw new Error("not implemented");var f=[];for(i in b)f.push(arrays[i]);return e.callback?(e.callback("",f),void 0):f}},a.csvEntry2Array=a.csv.toArray,a.csv2Array=a.csv.toArrays,a.csv2Dictionary=a.csv.toObjects}(jQuery);